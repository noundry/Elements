<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noundry Elements - Test Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .test-results {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .pass { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .noundry-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Noundry Elements - Test Suite</h1>
    
    <!-- Test 1: Basic Validation -->
    <div class="test-section">
        <h2>Test 1: Basic HTML5 Validation</h2>
        <noundry-element id="test1" error-disable-submit>
            <form>
                <div class="form-group">
                    <label>Required Text Field:</label>
                    <input type="text" name="requiredText" required data-error="This field is required">
                </div>
                <div class="form-group">
                    <label>Email Field:</label>
                    <input type="email" name="email" required data-error="Please enter a valid email">
                </div>
                <div class="form-group">
                    <label>Number Field (1-100):</label>
                    <input type="number" name="number" min="1" max="100" 
                           data-error-rangeunderflow="Must be at least 1"
                           data-error-rangeoverflow="Must be no more than 100">
                </div>
                <button type="submit">Submit</button>
            </form>
        </noundry-element>
        <div class="test-results" id="test1-results"></div>
    </div>
    
    <!-- Test 2: Custom Validation -->
    <div class="test-section">
        <h2>Test 2: Custom Validation Rules</h2>
        <noundry-element id="test2">
            <form>
                <div class="form-group">
                    <label>Password (min 8 chars, must contain uppercase):</label>
                    <input type="password" name="password">
                </div>
                <div class="form-group">
                    <label>Confirm Password:</label>
                    <input type="password" name="confirmPassword">
                </div>
                <button type="submit">Submit</button>
            </form>
        </noundry-element>
        <div class="test-results" id="test2-results"></div>
    </div>
    
    <!-- Test 3: State Management -->
    <div class="test-section">
        <h2>Test 3: State Management</h2>
        <noundry-element id="test3">
            <form>
                <div class="form-group">
                    <label>Test Input:</label>
                    <input type="text" name="testInput">
                </div>
                <button type="submit">Submit</button>
                <button type="button" onclick="test3Reset()">Reset</button>
                <button type="button" onclick="test3SetValues()">Set Values</button>
            </form>
        </noundry-element>
        <div class="test-results">
            <div>State: <span id="test3-state"></span></div>
            <div>Values: <span id="test3-values"></span></div>
        </div>
    </div>
    
    <!-- Test 4: Event Handling -->
    <div class="test-section">
        <h2>Test 4: Event Handling</h2>
        <noundry-element id="test4">
            <form>
                <div class="form-group">
                    <label>Event Test Input:</label>
                    <input type="text" name="eventInput" required>
                </div>
                <button type="submit">Submit</button>
            </form>
        </noundry-element>
        <div class="test-results">
            <h4>Event Log:</h4>
            <div class="log" id="test4-log"></div>
        </div>
    </div>
    
    <!-- Test Results Summary -->
    <div class="test-section">
        <h2>Test Results Summary</h2>
        <div id="summary" class="test-results"></div>
    </div>
    
    <script src="noundry-elements.js"></script>
    <script>
        // Test tracking
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };
        
        function addTestResult(name, passed, message) {
            testResults.total++;
            if (passed) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }
            testResults.tests.push({ name, passed, message });
        }
        
        function updateSummary() {
            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <h3>Summary</h3>
                <p>Total Tests: ${testResults.total}</p>
                <p class="pass">Passed: ${testResults.passed}</p>
                <p class="fail">Failed: ${testResults.failed}</p>
                <h4>Details:</h4>
                <ul>
                    ${testResults.tests.map(test => 
                        `<li class="${test.passed ? 'pass' : 'fail'}">${test.name}: ${test.message}</li>`
                    ).join('')}
                </ul>
            `;
        }
        
        // Test 1: Basic Validation
        const test1 = document.getElementById('test1');
        const test1Results = document.getElementById('test1-results');
        
        test1.addEventListener('noundry-submit', (e) => {
            const hasValues = Object.keys(e.detail.values).length > 0;
            addTestResult('Test 1 - Submit Event', hasValues, hasValues ? 'Submit event fired with values' : 'No values in submit event');
            updateTestResults();
        });
        
        test1.addEventListener('noundry-invalid', (e) => {
            const hasErrors = Object.keys(e.detail.errors).length > 0;
            addTestResult('Test 1 - Invalid Event', hasErrors, hasErrors ? 'Invalid event fired with errors' : 'No errors in invalid event');
            updateTestResults();
        });
        
        // Test form validation by triggering submit
        setTimeout(() => {
            test1.requestSubmit();
            
            // Check if submit button is disabled when form is invalid
            const submitBtn = test1.querySelector('[type="submit"]');
            const isDisabled = submitBtn.disabled;
            addTestResult('Test 1 - Submit Button Disable', isDisabled, isDisabled ? 'Submit button properly disabled' : 'Submit button not disabled on invalid form');
            updateTestResults();
        }, 100);
        
        // Test 2: Custom Validation
        const test2 = document.getElementById('test2');
        const test2Results = document.getElementById('test2-results');
        
        // Set up custom validation rules
        test2.setValidationRule('password', (value) => {
            if (!value) return 'Password is required';
            if (value.length < 8) return 'Password must be at least 8 characters';
            if (!/[A-Z]/.test(value)) return 'Password must contain an uppercase letter';
            return null;
        });
        
        test2.setValidationRule('confirmPassword', (value, allValues) => {
            if (!value) return 'Please confirm your password';
            if (value !== allValues.password) return 'Passwords do not match';
            return null;
        });
        
        test2.addEventListener('noundry-input', () => {
            const state = test2.$noundry;
            test2Results.innerHTML = `
                <h4>Custom Validation State:</h4>
                <p>Valid: ${state.isValid}</p>
                <p>Errors: ${Object.keys(state.errors).join(', ') || 'None'}</p>
            `;
        });
        
        // Test custom validation
        test2.setValues({ password: 'weak', confirmPassword: 'different' });
        setTimeout(() => {
            const state = test2.$noundry;
            const hasPasswordError = state.errors.password;
            const hasConfirmError = state.errors.confirmPassword;
            
            addTestResult('Test 2 - Password Validation', !!hasPasswordError, hasPasswordError ? 'Password validation working' : 'Password validation failed');
            addTestResult('Test 2 - Confirm Password Validation', !!hasConfirmError, hasConfirmError ? 'Confirm password validation working' : 'Confirm password validation failed');
            updateTestResults();
        }, 100);
        
        // Test 3: State Management
        const test3 = document.getElementById('test3');
        
        function updateTest3State() {
            const state = test3.$noundry;
            document.getElementById('test3-state').textContent = 
                `Dirty: ${state.isDirty}, Valid: ${state.isValid}, Submitting: ${state.isSubmitting}`;
            document.getElementById('test3-values').textContent = JSON.stringify(state.values);
        }
        
        function test3Reset() {
            test3.reset();
            updateTest3State();
            
            // Test reset functionality
            const state = test3.$noundry;
            const isClean = !state.isDirty;
            addTestResult('Test 3 - Reset Function', isClean, isClean ? 'Reset function works correctly' : 'Reset function failed');
            updateTestResults();
        }
        
        function test3SetValues() {
            test3.setValues({ testInput: 'Test Value' });
            updateTest3State();
            
            // Test setValues functionality
            const state = test3.$noundry;
            const hasValue = state.values.testInput === 'Test Value';
            addTestResult('Test 3 - SetValues Function', hasValue, hasValue ? 'SetValues function works correctly' : 'SetValues function failed');
            updateTestResults();
        }
        
        test3.addEventListener('noundry-input', updateTest3State);
        test3.addEventListener('noundry-change', updateTest3State);
        
        // Initial state test
        setTimeout(() => {
            const initialState = test3.$noundry;
            const hasStateObject = !!initialState;
            addTestResult('Test 3 - State Object Access', hasStateObject, hasStateObject ? 'State object accessible via $noundry' : 'State object not accessible');
            updateTest3State();
            updateTestResults();
        }, 100);
        
        // Test 4: Event Handling
        const test4 = document.getElementById('test4');
        const test4Log = document.getElementById('test4-log');
        let eventLog = [];
        
        function logEvent(eventName, detail) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${eventName}: ${JSON.stringify(detail, null, 2)}`);
            test4Log.textContent = eventLog.join('\n\n');
            test4Log.scrollTop = test4Log.scrollHeight;
        }
        
        test4.addEventListener('noundry-input', (e) => {
            logEvent('noundry-input', e.detail);
            addTestResult('Test 4 - Input Event', true, 'Input event fired correctly');
            updateTestResults();
        });
        
        test4.addEventListener('noundry-change', (e) => {
            logEvent('noundry-change', e.detail);
            addTestResult('Test 4 - Change Event', true, 'Change event fired correctly');
            updateTestResults();
        });
        
        test4.addEventListener('noundry-submit', (e) => {
            logEvent('noundry-submit', e.detail);
            addTestResult('Test 4 - Submit Event', true, 'Submit event fired correctly');
            updateTestResults();
        });
        
        test4.addEventListener('noundry-invalid', (e) => {
            logEvent('noundry-invalid', e.detail);
            addTestResult('Test 4 - Invalid Event', true, 'Invalid event fired correctly');
            updateTestResults();
        });
        
        // Function to update test results displays
        function updateTestResults() {
            updateSummary();
        }
        
        // Run initial tests
        setTimeout(() => {
            // Test basic functionality
            const allElements = document.querySelectorAll('noundry-element');
            const elementsFound = allElements.length === 4;
            addTestResult('Basic - Element Registration', elementsFound, elementsFound ? 'All noundry-element instances found' : 'Some noundry-element instances missing');
            
            // Test API availability
            const hasAPI = !!test1.$noundry;
            addTestResult('Basic - API Availability', hasAPI, hasAPI ? 'API object ($noundry) available' : 'API object not available');
            
            updateTestResults();
        }, 200);
        
        console.log('Test suite initialized. Interact with forms to see results.');
    </script>
</body>
</html>